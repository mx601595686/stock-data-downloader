"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const request = require("request");
const url_1 = require("url");
const Retry_1 = require("./Retry");
/**
 * @param method 方法
 * @param uri 地址
 * @param header 额外的请求头
 */
function fetch(method, uri, header = {}) {
    return new Promise((resolve, reject) => {
        request(uri, {
            method,
            encoding: null,
            gzip: true,
            timeout: 120 * 1000,
            headers: Object.assign({ 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36', 'Accept': 'application/json, text/javascript, */*; q=0.01', 'Accept-Encoding': 'gzip, deflate, sdch, br', 'Accept-Language': 'zh-CN,zh;q=0.8,en;q=0.6', 'Connection': 'keep - alive', 'Host': (new url_1.URL(uri)).host }, header)
        }, (err, response, body) => {
            err ? reject(err) : resolve(body);
        });
    });
}
exports.Get = Retry_1.Retry3(fetch.bind(undefined, 'GET'));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvb2xzL0h0dHBEb3dubG9hZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbUNBQW1DO0FBQ25DLDZCQUEwQjtBQUUxQixtQ0FBaUM7QUFFakM7Ozs7R0FJRztBQUNILGVBQWUsTUFBYyxFQUFFLEdBQVcsRUFBRSxTQUFjLEVBQUU7SUFDeEQsTUFBTSxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQ25DLE9BQU8sQ0FBQyxHQUFHLEVBQUU7WUFDVCxNQUFNO1lBQ04sUUFBUSxFQUFFLElBQUk7WUFDZCxJQUFJLEVBQUUsSUFBSTtZQUNWLE9BQU8sRUFBRSxHQUFHLEdBQUcsSUFBSTtZQUNuQixPQUFPLGtCQUNILFlBQVksRUFBRSwrR0FBK0csRUFDN0gsUUFBUSxFQUFFLGdEQUFnRCxFQUMxRCxpQkFBaUIsRUFBRSx5QkFBeUIsRUFDNUMsaUJBQWlCLEVBQUUseUJBQXlCLEVBQzVDLFlBQVksRUFBRSxjQUFjLEVBQzVCLE1BQU0sRUFBRSxDQUFDLElBQUksU0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUN4QixNQUFNLENBQ1o7U0FDSixFQUFFLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUN2QixHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRVksUUFBQSxHQUFHLEdBQW1ELGNBQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6InRvb2xzL0h0dHBEb3dubG9hZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcmVxdWVzdCBmcm9tICdyZXF1ZXN0JztcclxuaW1wb3J0IHsgVVJMIH0gZnJvbSAndXJsJztcclxuXHJcbmltcG9ydCB7IFJldHJ5MyB9IGZyb20gJy4vUmV0cnknO1xyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSBtZXRob2Qg5pa55rOVXHJcbiAqIEBwYXJhbSB1cmkg5Zyw5Z2AXHJcbiAqIEBwYXJhbSBoZWFkZXIg6aKd5aSW55qE6K+35rGC5aS0XHJcbiAqL1xyXG5mdW5jdGlvbiBmZXRjaChtZXRob2Q6IHN0cmluZywgdXJpOiBzdHJpbmcsIGhlYWRlcjogYW55ID0ge30pOiBQcm9taXNlPEJ1ZmZlcj4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICByZXF1ZXN0KHVyaSwge1xyXG4gICAgICAgICAgICBtZXRob2QsXHJcbiAgICAgICAgICAgIGVuY29kaW5nOiBudWxsLFxyXG4gICAgICAgICAgICBnemlwOiB0cnVlLFxyXG4gICAgICAgICAgICB0aW1lb3V0OiAxMjAgKiAxMDAwLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzU1LjAuMjg4My44NyBTYWZhcmkvNTM3LjM2JyxcclxuICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0LCAqLyo7IHE9MC4wMScsXHJcbiAgICAgICAgICAgICAgICAnQWNjZXB0LUVuY29kaW5nJzogJ2d6aXAsIGRlZmxhdGUsIHNkY2gsIGJyJyxcclxuICAgICAgICAgICAgICAgICdBY2NlcHQtTGFuZ3VhZ2UnOiAnemgtQ04semg7cT0wLjgsZW47cT0wLjYnLFxyXG4gICAgICAgICAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcCAtIGFsaXZlJyxcclxuICAgICAgICAgICAgICAgICdIb3N0JzogKG5ldyBVUkwodXJpKSkuaG9zdCxcclxuICAgICAgICAgICAgICAgIC4uLmhlYWRlclxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgKGVyciwgcmVzcG9uc2UsIGJvZHkpID0+IHtcclxuICAgICAgICAgICAgZXJyID8gcmVqZWN0KGVycikgOiByZXNvbHZlKGJvZHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBHZXQ6ICh1cmk6IHN0cmluZywgaGVhZGVyPzogYW55KSA9PiBQcm9taXNlPEJ1ZmZlcj4gPSBSZXRyeTMoZmV0Y2guYmluZCh1bmRlZmluZWQsICdHRVQnKSk7Il19
