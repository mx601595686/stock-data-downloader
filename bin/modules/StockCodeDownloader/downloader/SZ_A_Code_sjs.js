"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const xlsx = require("xlsx");
const expect = require("expect.js");
const HttpDownloader = require("../../../tools/HttpDownloader");
const StockMarket_1 = require("../../StockMarketDownloader/StockMarket");
const Retry_1 = require("../../../tools/Retry");
/**
 * 深交所，股票列表数据
 *
 * 深交所只提供深圳交易所的A股股票列表。返回`xlsx`格式的数据
 *
 * 相关页面：http://www.szse.cn/main/marketdata/jypz/colist/
 * 下载地址：http://www.szse.cn/szseWeb/ShowReport.szse?SHOWTYPE=xlsx&CATALOGID=1110&tab2PAGENO=1&ENCODE=1&TABKEY=tab2
 */
//下载地址
const address = 'http://www.szse.cn/szseWeb/ShowReport.szse?SHOWTYPE=xlsx&CATALOGID=1110&tab2PAGENO=1&ENCODE=1&TABKEY=tab2';
//下载数据
async function download() {
    const file = await HttpDownloader.Get(address);
    const data = xlsx.read(file);
    const result = xlsx.utils.sheet_to_json(data.Sheets["A股列表"]);
    return result.map(item => ({
        code: item['A股代码'].trim(),
        name: item['A股简称'].trim(),
        market: StockMarket_1.StockMarket.sz.id,
        isIndex: false
    }));
}
//检测下载的数据是否正确
function test(data) {
    expect(data.length).to.greaterThan(0);
    data.forEach(item => {
        expect(/^[03]\d{5}$/.test(item.code)).to.be.ok(); //股票代码
        expect(item.name.length).to.greaterThan(0); //确保公司名称不为空
    });
    return data;
}
/**
 * 深圳A股代码下载器
 */
exports.SZ_A_Code_sjs = Retry_1.Retry3(async () => test(await download()));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvU3RvY2tDb2RlRG93bmxvYWRlci9kb3dubG9hZGVyL1NaX0FfQ29kZV9zanMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNkI7QUFDN0Isb0NBQXFDO0FBRXJDLGdFQUFnRTtBQUNoRSx5RUFBc0U7QUFFdEUsZ0RBQThDO0FBRTlDOzs7Ozs7O0dBT0c7QUFFSCxNQUFNO0FBQ04sTUFBTSxPQUFPLEdBQUcsMkdBQTJHLENBQUM7QUFFNUgsTUFBTTtBQUNOLEtBQUs7SUFDRCxNQUFNLElBQUksR0FBRyxNQUFNLGNBQWMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDL0MsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFVLENBQUM7SUFFdEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksRUFBRyxJQUFJLENBQUMsTUFBTSxDQUFZLENBQUMsSUFBSSxFQUFFO1FBQ3JDLElBQUksRUFBRyxJQUFJLENBQUMsTUFBTSxDQUFZLENBQUMsSUFBSSxFQUFFO1FBQ3JDLE1BQU0sRUFBRSx5QkFBVyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1FBQ3pCLE9BQU8sRUFBRSxLQUFLO0tBQ2pCLENBQUMsQ0FBQyxDQUFDO0FBQ1IsQ0FBQztBQUVELGFBQWE7QUFDYixjQUFjLElBQStCO0lBQ3pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUV0QyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ2hCLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBRyxNQUFNO1FBQzFELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBUyxXQUFXO0lBQ25FLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQixDQUFDO0FBRUQ7O0dBRUc7QUFDVSxRQUFBLGFBQWEsR0FBRyxjQUFNLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoibW9kdWxlcy9TdG9ja0NvZGVEb3dubG9hZGVyL2Rvd25sb2FkZXIvU1pfQV9Db2RlX3Nqcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHhsc3ggZnJvbSAneGxzeCc7XHJcbmltcG9ydCBleHBlY3QgPSByZXF1aXJlKCdleHBlY3QuanMnKTtcclxuXHJcbmltcG9ydCAqIGFzIEh0dHBEb3dubG9hZGVyIGZyb20gJy4uLy4uLy4uL3Rvb2xzL0h0dHBEb3dubG9hZGVyJztcclxuaW1wb3J0IHsgU3RvY2tNYXJrZXQgfSBmcm9tICcuLi8uLi9TdG9ja01hcmtldERvd25sb2FkZXIvU3RvY2tNYXJrZXQnO1xyXG5pbXBvcnQgeyBTdG9ja0NvZGVEb3dubG9hZGVkRGF0YSB9IGZyb20gJy4uL1N0b2NrQ29kZURvd25sb2FkZWREYXRhJztcclxuaW1wb3J0IHsgUmV0cnkzIH0gZnJvbSAnLi4vLi4vLi4vdG9vbHMvUmV0cnknO1xyXG5cclxuLyoqXHJcbiAqIOa3seS6pOaJgO+8jOiCoeelqOWIl+ihqOaVsOaNrlxyXG4gKiBcclxuICog5rex5Lqk5omA5Y+q5o+Q5L6b5rex5Zyz5Lqk5piT5omA55qEQeiCoeiCoeelqOWIl+ihqOOAgui/lOWbnmB4bHN4YOagvOW8j+eahOaVsOaNrlxyXG4gKiBcclxuICog55u45YWz6aG16Z2i77yaaHR0cDovL3d3dy5zenNlLmNuL21haW4vbWFya2V0ZGF0YS9qeXB6L2NvbGlzdC9cclxuICog5LiL6L295Zyw5Z2A77yaaHR0cDovL3d3dy5zenNlLmNuL3N6c2VXZWIvU2hvd1JlcG9ydC5zenNlP1NIT1dUWVBFPXhsc3gmQ0FUQUxPR0lEPTExMTAmdGFiMlBBR0VOTz0xJkVOQ09ERT0xJlRBQktFWT10YWIyXHJcbiAqL1xyXG5cclxuLy/kuIvovb3lnLDlnYBcclxuY29uc3QgYWRkcmVzcyA9ICdodHRwOi8vd3d3LnN6c2UuY24vc3pzZVdlYi9TaG93UmVwb3J0LnN6c2U/U0hPV1RZUEU9eGxzeCZDQVRBTE9HSUQ9MTExMCZ0YWIyUEFHRU5PPTEmRU5DT0RFPTEmVEFCS0VZPXRhYjInO1xyXG5cclxuLy/kuIvovb3mlbDmja5cclxuYXN5bmMgZnVuY3Rpb24gZG93bmxvYWQoKTogUHJvbWlzZTxTdG9ja0NvZGVEb3dubG9hZGVkRGF0YVtdPiB7XHJcbiAgICBjb25zdCBmaWxlID0gYXdhaXQgSHR0cERvd25sb2FkZXIuR2V0KGFkZHJlc3MpO1xyXG4gICAgY29uc3QgZGF0YSA9IHhsc3gucmVhZChmaWxlKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IHhsc3gudXRpbHMuc2hlZXRfdG9fanNvbihkYXRhLlNoZWV0c1tcIkHogqHliJfooahcIl0pIGFzIGFueVtdO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQubWFwKGl0ZW0gPT4gKHtcclxuICAgICAgICBjb2RlOiAoaXRlbVsnQeiCoeS7o+eggSddIGFzIHN0cmluZykudHJpbSgpLFxyXG4gICAgICAgIG5hbWU6IChpdGVtWydB6IKh566A56ewJ10gYXMgc3RyaW5nKS50cmltKCksXHJcbiAgICAgICAgbWFya2V0OiBTdG9ja01hcmtldC5zei5pZCxcclxuICAgICAgICBpc0luZGV4OiBmYWxzZVxyXG4gICAgfSkpO1xyXG59XHJcblxyXG4vL+ajgOa1i+S4i+i9veeahOaVsOaNruaYr+WQpuato+ehrlxyXG5mdW5jdGlvbiB0ZXN0KGRhdGE6IFN0b2NrQ29kZURvd25sb2FkZWREYXRhW10pIHtcclxuICAgIGV4cGVjdChkYXRhLmxlbmd0aCkudG8uZ3JlYXRlclRoYW4oMCk7XHJcblxyXG4gICAgZGF0YS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgIGV4cGVjdCgvXlswM11cXGR7NX0kLy50ZXN0KGl0ZW0uY29kZSkpLnRvLmJlLm9rKCk7ICAgLy/ogqHnpajku6PnoIFcclxuICAgICAgICBleHBlY3QoaXRlbS5uYW1lLmxlbmd0aCkudG8uZ3JlYXRlclRoYW4oMCk7ICAgICAgICAgLy/noa7kv53lhazlj7jlkI3np7DkuI3kuLrnqbpcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG4vKipcclxuICog5rex5ZyzQeiCoeS7o+eggeS4i+i9veWZqFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IFNaX0FfQ29kZV9zanMgPSBSZXRyeTMoYXN5bmMgKCkgPT4gdGVzdChhd2FpdCBkb3dubG9hZCgpKSk7Il19
