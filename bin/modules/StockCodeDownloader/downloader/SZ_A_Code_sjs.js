"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const xlsx = require("xlsx");
const expect = require("expect.js");
const HttpDownloader = require("../../../tools/HttpDownloader");
const Retry_1 = require("../../../tools/Retry");
const StockMarketType_1 = require("../../StockMarketList/StockMarketType");
/**
 * 深交所，股票列表数据
 *
 * 深交所只提供深圳交易所的A股股票列表。返回`xlsx`格式的数据
 *
 * 相关页面：http://www.szse.cn/main/marketdata/jypz/colist/
 * 下载地址：http://www.szse.cn/szseWeb/ShowReport.szse?SHOWTYPE=xlsx&CATALOGID=1110&tab2PAGENO=1&ENCODE=1&TABKEY=tab2
 */
//下载地址
const address = 'http://www.szse.cn/szseWeb/ShowReport.szse?SHOWTYPE=xlsx&CATALOGID=1110&tab2PAGENO=1&ENCODE=1&TABKEY=tab2';
//下载数据
async function download() {
    const file = await HttpDownloader.Get(address);
    const data = xlsx.read(file);
    const result = xlsx.utils.sheet_to_json(data.Sheets["A股列表"]);
    return result.map(item => ({
        code: item['A股代码'].trim(),
        name: item['A股简称'].trim(),
        market: StockMarketType_1.StockMarketType.sz.id,
        isIndex: false
    }));
}
//检测下载的数据是否正确
function test(data) {
    expect(data.length).to.greaterThan(0);
    data.forEach(item => {
        expect(/^[03]\d{5}$/.test(item.code)).to.be.ok(); //股票代码
        expect(item.name.length).to.greaterThan(0); //确保公司名称不为空
    });
    return data;
}
/**
 * 深圳A股代码下载器
 */
exports.SZ_A_Code_sjs = Retry_1.Retry3(async () => test(await download()));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvU3RvY2tDb2RlRG93bmxvYWRlci9kb3dubG9hZGVyL1NaX0FfQ29kZV9zanMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNkI7QUFDN0Isb0NBQXFDO0FBRXJDLGdFQUFnRTtBQUNoRSxnREFBOEM7QUFFOUMsMkVBQXdFO0FBRXhFOzs7Ozs7O0dBT0c7QUFFSCxNQUFNO0FBQ04sTUFBTSxPQUFPLEdBQUcsMkdBQTJHLENBQUM7QUFFNUgsTUFBTTtBQUNOLEtBQUs7SUFDRCxNQUFNLElBQUksR0FBRyxNQUFNLGNBQWMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDL0MsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFVLENBQUM7SUFFdEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksRUFBRyxJQUFJLENBQUMsTUFBTSxDQUFZLENBQUMsSUFBSSxFQUFFO1FBQ3JDLElBQUksRUFBRyxJQUFJLENBQUMsTUFBTSxDQUFZLENBQUMsSUFBSSxFQUFFO1FBQ3JDLE1BQU0sRUFBRSxpQ0FBZSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1FBQzdCLE9BQU8sRUFBRSxLQUFLO0tBQ2pCLENBQUMsQ0FBQyxDQUFDO0FBQ1IsQ0FBQztBQUVELGFBQWE7QUFDYixjQUFjLElBQXFCO0lBQy9CLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUV0QyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ2hCLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBRyxNQUFNO1FBQzFELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBUyxXQUFXO0lBQ25FLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQixDQUFDO0FBRUQ7O0dBRUc7QUFDVSxRQUFBLGFBQWEsR0FBRyxjQUFNLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoibW9kdWxlcy9TdG9ja0NvZGVEb3dubG9hZGVyL2Rvd25sb2FkZXIvU1pfQV9Db2RlX3Nqcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHhsc3ggZnJvbSAneGxzeCc7XHJcbmltcG9ydCBleHBlY3QgPSByZXF1aXJlKCdleHBlY3QuanMnKTtcclxuXHJcbmltcG9ydCAqIGFzIEh0dHBEb3dubG9hZGVyIGZyb20gJy4uLy4uLy4uL3Rvb2xzL0h0dHBEb3dubG9hZGVyJztcclxuaW1wb3J0IHsgUmV0cnkzIH0gZnJvbSAnLi4vLi4vLi4vdG9vbHMvUmV0cnknO1xyXG5pbXBvcnQgeyBTdG9ja0NvZGVUeXBlIH0gZnJvbSAnLi4vU3RvY2tDb2RlVHlwZSc7XHJcbmltcG9ydCB7IFN0b2NrTWFya2V0VHlwZSB9IGZyb20gJy4uLy4uL1N0b2NrTWFya2V0TGlzdC9TdG9ja01hcmtldFR5cGUnO1xyXG5cclxuLyoqXHJcbiAqIOa3seS6pOaJgO+8jOiCoeelqOWIl+ihqOaVsOaNrlxyXG4gKiBcclxuICog5rex5Lqk5omA5Y+q5o+Q5L6b5rex5Zyz5Lqk5piT5omA55qEQeiCoeiCoeelqOWIl+ihqOOAgui/lOWbnmB4bHN4YOagvOW8j+eahOaVsOaNrlxyXG4gKiBcclxuICog55u45YWz6aG16Z2i77yaaHR0cDovL3d3dy5zenNlLmNuL21haW4vbWFya2V0ZGF0YS9qeXB6L2NvbGlzdC9cclxuICog5LiL6L295Zyw5Z2A77yaaHR0cDovL3d3dy5zenNlLmNuL3N6c2VXZWIvU2hvd1JlcG9ydC5zenNlP1NIT1dUWVBFPXhsc3gmQ0FUQUxPR0lEPTExMTAmdGFiMlBBR0VOTz0xJkVOQ09ERT0xJlRBQktFWT10YWIyXHJcbiAqL1xyXG5cclxuLy/kuIvovb3lnLDlnYBcclxuY29uc3QgYWRkcmVzcyA9ICdodHRwOi8vd3d3LnN6c2UuY24vc3pzZVdlYi9TaG93UmVwb3J0LnN6c2U/U0hPV1RZUEU9eGxzeCZDQVRBTE9HSUQ9MTExMCZ0YWIyUEFHRU5PPTEmRU5DT0RFPTEmVEFCS0VZPXRhYjInO1xyXG5cclxuLy/kuIvovb3mlbDmja5cclxuYXN5bmMgZnVuY3Rpb24gZG93bmxvYWQoKTogUHJvbWlzZTxTdG9ja0NvZGVUeXBlW10+IHtcclxuICAgIGNvbnN0IGZpbGUgPSBhd2FpdCBIdHRwRG93bmxvYWRlci5HZXQoYWRkcmVzcyk7XHJcbiAgICBjb25zdCBkYXRhID0geGxzeC5yZWFkKGZpbGUpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0geGxzeC51dGlscy5zaGVldF90b19qc29uKGRhdGEuU2hlZXRzW1wiQeiCoeWIl+ihqFwiXSkgYXMgYW55W107XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdC5tYXAoaXRlbSA9PiAoe1xyXG4gICAgICAgIGNvZGU6IChpdGVtWydB6IKh5Luj56CBJ10gYXMgc3RyaW5nKS50cmltKCksXHJcbiAgICAgICAgbmFtZTogKGl0ZW1bJ0HogqHnroDnp7AnXSBhcyBzdHJpbmcpLnRyaW0oKSxcclxuICAgICAgICBtYXJrZXQ6IFN0b2NrTWFya2V0VHlwZS5zei5pZCxcclxuICAgICAgICBpc0luZGV4OiBmYWxzZVxyXG4gICAgfSkpO1xyXG59XHJcblxyXG4vL+ajgOa1i+S4i+i9veeahOaVsOaNruaYr+WQpuato+ehrlxyXG5mdW5jdGlvbiB0ZXN0KGRhdGE6IFN0b2NrQ29kZVR5cGVbXSkge1xyXG4gICAgZXhwZWN0KGRhdGEubGVuZ3RoKS50by5ncmVhdGVyVGhhbigwKTtcclxuXHJcbiAgICBkYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KC9eWzAzXVxcZHs1fSQvLnRlc3QoaXRlbS5jb2RlKSkudG8uYmUub2soKTsgICAvL+iCoeelqOS7o+eggVxyXG4gICAgICAgIGV4cGVjdChpdGVtLm5hbWUubGVuZ3RoKS50by5ncmVhdGVyVGhhbigwKTsgICAgICAgICAvL+ehruS/neWFrOWPuOWQjeensOS4jeS4uuepulxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDmt7HlnLNB6IKh5Luj56CB5LiL6L295ZmoXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgU1pfQV9Db2RlX3NqcyA9IFJldHJ5Myhhc3luYyAoKSA9PiB0ZXN0KGF3YWl0IGRvd25sb2FkKCkpKTsiXX0=
